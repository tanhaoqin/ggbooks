INSERT into admin values (DEFAULT, 'Nikhil', 'brahmin');
INSERT into admin values (DEFAULT, 'KangSheng', 'incpio');
INSERT into user values (DEFAULT, 'ks@gmail.com', 'pw1');
insert into customer(userID,creditcard) values(3,'123412');
INSERT into user values (DEFAULT, 'ns@gmail.com', 'pw2');
insert into customer(userID,creditcard) values(4,'876543');

INSERT into book values ('9780380973651','American Gods','Neil Gaiman',DEFAULT,'H',NULL,5,41.47,'Fiction', 'HarperCollins Publishers Inc',2000,DEFAULT);
INSERT into book values ('9780380789030','American Gods','Neil Gaiman',DEFAULT,'P',NULL,5,15.68,'Fiction', 'HarperCollins Publishers Inc',2002,DEFAULT);
INSERT into book values ('9781472228420','The Ocean at the End of the Lane','Neil Gaiman',DEFAULT,'P',NULL,5,18.64,'Fiction', 'Headline Publishing Group',2015,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/2de25c3a/m/9781472228420.jpg','A special Christmas edition of the Sunday Times bestseller. WINNER OF THE SPECSAVERS NATIONAL BOOK AWARDS 2013 BOOK OF THE YEAR Dive into a magical novel of memory and the adventure of childhood, from one of the brightest, most brilliant writers of our generation. It began for our narrator forty years ago when the family lodger stole their car and committed suicide in it, stirring up ancient powers best left undisturbed. Dark creatures from beyond the world are on the loose, and it will take everything our narrator has just to stay alive. There is primal horror here, and menace unleashed - within his family and from the forces that have gathered to destroy it. His only defense is three women, on a farm at the end of the lane. The youngest of them claims that her duckpond is an ocean. The oldest can remember the Big Bang. \nTHE OCEAN AT THE END OF THE LANE is a fable that reshapes modern fantasy: moving, terrifying and elegiac - as pure as a dream, as delicate as a butterfly\'s wing, as dangerous as a knife in the dark.');
INSERT into book values ('9781408859643','The Sleeper and the Spindle','Neil Gaiman',DEFAULT,'H',NULL,5,26.91,'Fiction', 'Bloomsbury Publishing PLC',2014,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/267e99ff/m/9781408859643.jpg','A thrillingly reimagined fairy tale from the truly magical combination of author Neil Gaiman and illustrator Chris Riddell - weaving together a sort-of Snow White and an almost Sleeping Beauty with a thread of dark magic, which will hold readers spellbound from start to finish. On the eve of her wedding, a young queen sets out to rescue a princess from an enchantment. She casts aside her fine wedding clothes, takes her chain mail and her sword and follows her brave dwarf retainers into the tunnels under the mountain towards the sleeping kingdom. This queen will decide her own future - and the princess who needs rescuing is not quite what she seems. Twisting together the familiar and the new, this perfectly delicious, captivating and darkly funny tale shows its creators at the peak of their talents. Lavishly produced, packed with glorious Chris Riddell illustrations enhanced with metallic ink, this is a spectacular and magical gift.');
INSERT into book values ('9780755322800','Neverwhere','Neil Gaiman',DEFAULT,'P',NULL,5,19.47,'Fiction', 'Headline Publishing Group',2005,DEFAULT,'https://dut2up1aqgazz.cloudfront.net/af610b30/m/9780755322800.jpg','The stunningly original and brilliant first novel from storytelling genius Neil Gaiman. Now a six part radio dramatisation on BBC Radio 4 and BBC Radio 4 Extra. \nUnder the streets of London there\'s a world most people could never even dream of. A city of monsters and saints, murderers and angels, and pale girls in black velvet. Richard Mayhew is a young businessman who is about to find out more than he bargained for about this other London. A single act of kindness catapults him out of his safe and predictable life and into a world that is at once eerily familiar and yet utterly bizarre. There\'s a girl named Door, an Angel called Islington, an Earl who holds Court on the carriage of a Tube train, a Beast in a labyrinth, and dangers and delights beyond imagining...And Richard, who only wants to go home, is to find a strange destiny waiting for him below the streets of his native city. \nIncludes extra material exclusive to this Headline Review edition.');
INSERT into book values ('9781472217721','Trigger Warning: Short Fictions and Disturbances','Neil Gaiman',DEFAULT,'P',NULL,5,19.49,'Fiction', 'Headline Publishing Group',2005,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/885295ca/m/9781472217721.jpg','In Trigger Warning, global phenomenon and Sunday Times bestselling author Neil Gaiman returns to dazzle, captivate, haunt, and entertain with this third collection of short fiction following Smoke and Mirrors and Fragile Things, which includes a never-before published American Gods story, BLACK DOG. The Truth is a Cave in the Black Mountains was serialised on BBC Radio 4\'s Book at Bedtime in November 2015. \'We are all wearing masks. That is what makes us interesting. These are stories about those masks, and the people we are underneath them.\' Neil Gaiman, writing from a cabin in the dark woods. Make sure you secure your own mask before reading. Before being transported to worlds filled with witches, watchers and big black bees, with deathless Kin and pirate girls, with things that prowl in the darkness beyond the circle fire, to find the Shadder lurking at your journey\'s end. But then what happens? There\'s always something waiting for you. There\'s always more. Just keep turning the pages. \'We each have our little triggers.\'\nLiterary alchemy from \'a writer of rare perception and endless imagination\' (William Gibson), TRIGGER WARNING is a cornucopia of storytelling: horror and ghost stories, science fiction and fairy tales, fabulism and poetry. It will open your eyes to the inexhaustible supply of darkness around you, the magic and the monsters, the myths and the miracles, and to finding truths in the most extraordinary of places.');
INSERT into book values ('9781401248963','The Sandman: Overture','Neil Gaiman',DEFAULT,'H',NULL,5,40.48,'Fiction', 'DC Comics',2015,DEFAULT,'https://dut2up1aqgazz.cloudfront.net/4844e9d3/m/9781401248963.jpg','"Twenty-five years since THE SANDMAN first changed the landscape of modern comics, Neil Gaiman\'s legendary series is back in a deluxe hardcover edition! THE SANDMAN: OVERTURE heralds New York Times best-selling writer Neil Gaiman\'s return to the art form that made him famous, ably abetted by artistic luminary JH Williams III (BATWOMAN, PROMETHEA), whose lush, widescreen images provide an epic scope to The Sandman\'s origin story. From the birth of a galaxy to the moment that Morpheus is captured, THE SANDMAN: OVERTURE will feature cameo appearances by fan-favorite characters such as The Corinthian, Merv Pumpkinhead and, of course, the Dream King\'s siblings: Death, Desire, Despair, Delirium, Destruction and Destiny"');

INSERT into book values ('9781474603041','The Grownup','Gillian Flynn',DEFAULT,'P',NULL,5,9.53,'Fiction', 'Orion Publishing Co',2015,DEFAULT);
INSERT into book values ('9780753827031','Dark Places','Gillian Flynn',DEFAULT,'P',NULL,5,19.69,'Fiction', 'Orion Publishing Co',2010,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/037b5946/m/9780753827031.jpg','Your brother murdered your family. Your evidence put him away ...the gripping second novel from the author of the mega-bestselling GONE GIRL. Libby Day was just seven years old when her older brother massacred her family while she hid in a cupboard. Her evidence helped put him away. Ever since then she has been drifting, surviving for over 20 years on the proceeds of the \'Libby Day fund\'. But now the money is running out and Libby is desperate. When she is offered $500 to do a guest appearance, she feels she has to accept. But this is no ordinary gathering. The Kill Club is a group of true-crime obsessives who share information on notorious murders, and they think her brother Ben is innocent. Ben was a social misfit, ground down by the small-town farming community in which he lived. But he did have a girlfriend - a brooding heavy metal fan called Diondra. Through her, Ben became involved with drugs and the dark arts. When the town suddenly turned against him, his thoughts turned black. But was he capable of murder? Libby must delve into her family\'s past to uncover the truth - no matter how painful...');
INSERT into book values ('9780753822210','Sharp Objects','Gillian Flynn',DEFAULT,'P',NULL,5,20.03,'Fiction', 'Orion Publishing Co',2007,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/643c4cc7/m/9780753822210.jpg','Some scars never heal ...An addictive thriller from the author of the mega bestseller GONE GIRL. When two girls are abducted and killed in Missouri, journalist Camille Preaker is sent back to her home town to report on the crimes. Long-haunted by a childhood tragedy and estranged from her mother for years, Camille suddenly finds herself installed once again in her family\'s mansion, reacquainting herself with her distant mother and the half-sister she barely knows - a precocious 13-year-old who holds a disquieting grip on the town. As Camille works to uncover the truth about these violent crimes, she finds herself identifying with the young victims - a bit too strongly. Clues keep leading to dead ends, forcing Camille to unravel the psychological puzzle of her own past to get at the story. Dogged by her own demons, Camille will have to confront what happened to her years before if she wants to survive this homecoming.');
INSERT into book values ('9781780228228','Gone Girl','Gillian Flynn',DEFAULT,'P',NULL,5,19.71,'Fiction', 'Orion Publishing Co',2014,DEFAULT,'https://d1m60b4xe0f3nb.cloudfront.net/5b9988be/m/9781780228228.jpg','THE ADDICTIVE No.1 BESTSELLER THAT EVERYONE IS TALKING ABOUT. Who are you? What have we done to each other? These are the questions Nick Dunne finds himself asking on the morning of his fifth wedding anniversary, when his wife Amy suddenly disappears. The police suspect Nick. Amy\'s friends reveal that she was afraid of him, that she kept secrets from him. He swears it isn\'t true. A police examination of his computer shows strange searches. He says they weren\'t made by him. And then there are the persistent calls on his mobile phone. So what really did happen to Nick\'s beautiful wife?');

INSERT into book values ('9781405925136','The Magical Christmas','Lizzie Mary Cullen',DEFAULT,'P',NULL,5,22.69,'Craft & Hobbies', 'Penguin Books Ltd',2015,DEFAULT);
INSERT into book values ('9781760113636','Neurotribes','Steve Silberman',DEFAULT,'H',NULL,5,36.61,'Psychology', 'Allen & Unwin',2015,DEFAULT);
INSERT into book values ('9781780746357','A Brief History of Seven Killings','Marlon James',DEFAULT,'P',NULL,5,23.64,'Fiction', 'Oneworld Publications',2015,DEFAULT);

INSERT into book values ('9781782117896','A Boy Called Christmas','Matt Haig',DEFAULT,'H',NULL,5,27.36,'Children\'s Books', 'Canongate Books Ltd',2015,DEFAULT);

INSERT into book values ('9781473698888','The Bazaar of Bad Dreams','Stephen King',DEFAULT,'H',NULL,5,43.57,'Fiction', 'Hodder & Stoughton General Division',2015,DEFAULT);

INSERT into book values ('9780115533426','The Official Highway Code 2015','Driver and Vehicle Standards Agency (DVSA)',DEFAULT,'P',NULL,5,9.02,'Self-help', 'TSO',2015,DEFAULT);

INSERT into book values ('9781846683800','SPQR: A History of Ancient Rome','Mary Beard',DEFAULT,'H',NULL,5,52.08,'History', 'Profile Books Ltd',2015,DEFAULT);
update book set image_url='https://d1m60b4xe0f3nb.cloudfront.net/ddf8e60f/m/9781118951309.jpg'
where isbn13 like '9781118951309' ; 
update book set summary='Hands-on exercises help you learn to code like a pro\nNo coding experience is required for Coding For Dummies, your one-stop guide to building a foundation of knowledge in writing computer code for web, application, and software development. It doesn?t matter if you?ve dabbled in coding or never written a line of code, this book guides you through the basics. Using foundational web development languages like HTML, CSS, and JavaScript, it explains in plain English how coding works and why it\'s needed.\nOnline exercises developed by Codecademy, a leading online code training site, help hone coding skills and demonstrate results as you practice.\nThe site provides an environment where you can try out tutorials built into the text and see the actual output from your coding. You?ll also gain access to end-of-chapter challenges to apply newly acquired skills to a less-defined assignment. So what are you waiting for?\nThe current demand for workers with coding and computer science skills far exceeds the supply\nTeaches the foundations of web development languages in an easy-to-understand format\nOffers unprecedented opportunities to practice basic coding languages\nReaders can access online hands-on exercises and end-of-chapter assessments that develop and test their new-found skills\nIf you?re a student looking for an introduction to the basic concepts of coding or a professional looking to add new skills, Coding For Dummies has you covered.' 
where isbn13 like '9781118951309';
INSERT into book values ('9781118951309','Coding For Dummies','Nikhil Abraham',DEFAULT,'P',NULL,5,35.74,'Computing & Information Technology', ' John Wiley & Sons Inc',2000,DEFAULT);

INSERT into book values ('9780007179732','The Monk Who Sold His Ferrari','Robin S. Sharma',DEFAULT,'P',NULL,5,20.61,'Health', 'HarperCollins Publishers',2004,DEFAULT);
INSERT into book values ('9780571314263','Family Life','Akhil Sharma',DEFAULT,'H',NULL,5,29.25,'Fiction', 'Faber & Faber',2014,DEFAULT);



alter table book
add column image_url varchar(255);
alter table book
add column summary text;

update book set image_url='https://dut2up1aqgazz.cloudfront.net/3a33a793/m/9780380973651.jpg'
where isbn13 like '9780380973651' ; 
update book set summary='The storm was coming....\nShadow spent three years in prison, keeping his head down, doing his time. All he wanted was to get back to the loving arms of his wife and to stay out of trouble for the rest of his life. But days before his scheduled release, he learns that his wife has been killed in an accident, and his world becomes a colder place.\nOn the plane ride home to the funeral, Shadow meets a grizzled man who calls himself Mr. Wednesday. A self-styled grifter and rogue, Wednesday offers Shadow a job. And Shadow, a man with nothing to lose, accepts.\nBut working for the enigmatic Wednesday is not without its price, and Shadow soon learns that his role in Wednesday\'s schemes will be far more dangerous than he ever could have imagined. Entangled in a world of secrets, he embarks on a wild road trip and encounters, among others, the murderous Czernobog, the impish Mr. Nancy, and the beautiful Easter -- all of whom seem to know more about Shadow than he himself does.\nShadow will learn that the past does not die, that everyone, including his late wife, had secrets, and that the stakes are higher than anyone could have imagined.\nAll around them a storm of epic proportions threatens to break. Soon Shadow and Wednesday will be swept up into a conflict as old as humanity itself. For beneath the placid surface of everyday life a war is being fought -- and the prize is the very soul of America.\nAs unsettling as it is exhilarating, American Gods is a dark and kaleidoscopic journey deep into myth and across an America at once eerily familiar and utterly alien. Magnificently told, this work of literary magic will haunt the reader far beyond the final page.' 
where isbn13 like '9780380973651';

update book set image_url='https://dut2up1aqgazz.cloudfront.net/5678ca59/m/9780380789030.jpg'
where isbn13 like '9780380789030' ; 
update book set summary='Shadow is a man with a past. But now he wants nothing more than to live a quiet life with his wife and stay out of trouble. Until he learns that she\'s been killed in a terrible accident.\nFlying home for the funeral, as a violent storm rocks the plane, a strange man in the seat next to him introduces himself. The man calls himself Mr. Wednesday, and he knows more about Shadow than is possible.\nHe warns Shadow that a far bigger storm is coming. And from that moment on, nothing will ever he the same...' 
where isbn13 like '9780380789030';

update book set image_url='https://dut2up1aqgazz.cloudfront.net/2c78fb3b/m/9781474603041.jpg'
where isbn13 like '9781474603041' ; 
update book set summary='A young woman is making a living faking it as a cut-price psychic (with some illegal soft-core sex work on the side). She makes a decent wage mostly by telling people what they want to hear. But then she meets Susan Burke. Susan moved to the city one year ago with her husband and 15-year-old stepson Miles. They live in a Victorian house called Carterhook Manor. Susan has become convinced that some malevolent spirit is inhabiting their home. The young woman doesn\'t believe in exorcism or the supernatural. However when she enters the house for the first time, she begins to feel it too, as if the very house is watching her, waiting, biding its time ...The Grownup, which originally appeared as \'What Do You Do?\' in George R. R. Martin\'s Rogues anthology, proves once again that Gillian Flynn is one of the world\'s most original and skilled voices in fiction.' 
where isbn13 like '9781474603041';

update book set image_url='https://d1m60b4xe0f3nb.cloudfront.net/ddf8e60f/m/9781118951309.jpg'
where isbn13 like '9781118951309' ; 
update book set summary='Hands-on exercises help you learn to code like a pro\nNo coding experience is required for Coding For Dummies, your one-stop guide to building a foundation of knowledge in writing computer code for web, application, and software development. It doesn?t matter if you?ve dabbled in coding or never written a line of code, this book guides you through the basics. Using foundational web development languages like HTML, CSS, and JavaScript, it explains in plain English how coding works and why it\'s needed.\nOnline exercises developed by Codecademy, a leading online code training site, help hone coding skills and demonstrate results as you practice.\nThe site provides an environment where you can try out tutorials built into the text and see the actual output from your coding. You?ll also gain access to end-of-chapter challenges to apply newly acquired skills to a less-defined assignment. So what are you waiting for?\nThe current demand for workers with coding and computer science skills far exceeds the supply\nTeaches the foundations of web development languages in an easy-to-understand format\nOffers unprecedented opportunities to practice basic coding languages\nReaders can access online hands-on exercises and end-of-chapter assessments that develop and test their new-found skills\nIf you?re a student looking for an introduction to the basic concepts of coding or a professional looking to add new skills, Coding For Dummies has you covered.' 
where isbn13 like '9781118951309';

update book set image_url='https://dut2up1aqgazz.cloudfront.net/ee69db76/m/9781405925136.jpg'
where isbn13 like '9781405925136' ; 
update book set summary='From Lizzie Mary Cullen, the illustrator behind hit colouring book The Magical City, comes a brand new treat for the winter. Settle down by the fire and immerse yourself in this mesmerising new colouring book for adults. Join celebrations across the world and throughout the years, from skating at the Rockefeller Center to surfing in Sydney and frost fairs on the Thames to Victorian toy shops. Travel with the wise men following a star, spot Santa\'s sleigh skimming over the rooftops and discover dazzling gingerbread houses with Lizzie\'s intricate inky illustrations. Fans of mindfulness and art therapy will love this beautiful Christmas gift book. A whole world of festivity is waiting for you inside...' 
where isbn13 like '9781405925136';

update book set image_url='https://d1m60b4xe0f3nb.cloudfront.net/d4544f7d/m/9780571314263.jpg'
where isbn13 like '9780571314263' ; 
update book set summary='For eight-year-old Ajay Mishra and his older brother Birju, family life in Delhi in the late 1970s follows a comfortable, predictable routine: bathing on the roof, queuing for milk, playing day-long games of cricket in the street. Everything changes when their father finds a job in America, a land of carpets and elevators, swimsuits and hot water.' 
where isbn13 like '9780571314263';

update book set image_url='https://dut2up1aqgazz.cloudfront.net/51eac856/m/9780007179732.jpg'
where isbn13 like '9780007179732' ; 
update book set summary='An internationally bestselling fable about a spiritual journey, littered with powerful life lessons that teach us how to abandon consumerism in order to embrace destiny, live life to the full and discover joy. * This inspiring tale is based on the author\'s own search for life\'s true purpose, providing a step-by-step approach to living with greater courage, balance, abundance and joy. * It tells the story of Julian Mantle, a lawyer forced to confront the spiritual crisis of his out-of-balance life: following a heart attack, he decides to sell all his beloved possesions and trek to India. On a life-changing odyssey to an ancient culture, he meets Himalayan gurus who offer powerful, wise and practical lessons that teach us to: - Develop joyful thoughts - Follow our life\'s mission - Cultivate self-discipline and act courageously - Value time as our most important commodity - Nourish our relationships - Live fully, one day at a time' 
where isbn13 like '9780007179732';

INSERT into feedback values (DEFAULT,DEFAULT,7,NULL,3,'9780380973651',DEFAULT);
INSERT into feedback values (DEFAULT,DEFAULT,9,NULL,4,'9780380973651',DEFAULT);

INSERT into rating values (3,2,3);

INSERT into cart values ('9780380973651',3,DEFAULT);
INSERT into cart values ('9780380973651',4,DEFAULT);
INSERT into cart values ('9780571314263',3,DEFAULT);
INSERT into cart values ('9781118951309',3,DEFAULT);
select * from cart;

insert into orders 
values (default, default, default, 4, 
(select sum(b.price)*c.quantity from book b join cart c where b.isbn13=c.book and c.userID=4),
'876543');
insert into orderItem 
select o.orderid, c.book,c.quantity from orders o join cart c where o.userID=c.userID;
delete from cart where userID=4;

select * from book b join cart c where c.book=b.isbn13 and userID=3;

select * from book where title like '%Neil%' or author like '%Neil%';
select fbID,date,score,comment,userID from  feedback where book like '9780380973651';
select * from user u where u.email='ks@gmail.com' and u.password='pw1';

select * from feedback where book like '9780380973651' ORDER BY avgUseful DESC  LIMIT 1, 10;

select * from orders o join orderItem oi join book b where oi.book=b.isbn13 AND o.orderId=oi.orderId AND o.userID= 3;
select * from feedback f join book b where f.book=b.isbn13 AND f.userID = 3;

select * from orders o join orderItem oi join book b 
where oi.book=b.isbn13 AND o.orderId=oi.orderId AND o.userID in
(SELECT customer.userID
FROM (customer INNER JOIN (orders INNER JOIN orderItem))
WHERE orderItem.book = '9780380973651');

select * from orders;

select book from orders o join orderItem oi where o.orderid=oi.orderid AND userId=4;

select * from orders o2 join orderItem oi2 join book b where o2.orderid=oi2.orderid AND oi2.book=b.isbn13 AND o2.orderid in
(select o1.orderid from orders o1 join orderItem oi1 where o1.orderid=oi1.orderid AND book in
(select book from orders o join orderItem oi where o.orderid=oi.orderid AND userId=4) AND o1.userID !=4) AND book not in 
(select book from orders o join orderItem oi where o.orderid=oi.orderid AND userId=4);

select sum(quantity) AS sold, b.* from orders o join orderItem oi join book b where o.orderid=oi.orderid and b.isbn13=oi.book and o.date BETWEEN NOW() - INTERVAL 30 DAY AND NOW() group by book order by sold DESC limit 6;

select sum(quantity) AS sold, b.* from orders o join orderItem oi join book b where o.orderid=oi.orderid and b.isbn13=oi.book and o.date BETWEEN NOW() - INTERVAL 30 DAY AND NOW() group by b.author order by sold DESC limit 6;

select f.fbID, f.book, f.date, f.score, f.comment, f.avgUseful, c.fullname, c.userID from feedback f left join customer c on (f.userID = c.userID) where f.book like '9780380973651'  ORDER BY f.avgUseful DESC;
select count(fbID) from feedback where book LIKE '9780380973651';

select r.usefulness,r.fbID from rating r join feedback f where r.fbID=f.fbID and r.userID like 3 and f.book like '9780380973651';

select * from user;
select * from cart;
select * from customer;
select * from rating;
select * from feedback;